<!-- Cookie Consent Banner -->
<div id="cookie-consent" class="fixed bottom-0 left-0 right-0 bg-white border-t border-neutral-200 shadow-2xl transition-transform duration-300 transform translate-y-full" style="display: none; z-index: 9998;">
  <div class="container py-4">
    <div class="flex flex-col md:flex-row items-start md:items-center gap-4">
      <div class="flex-1">
        <div class="flex items-center mb-2">
          <svg class="w-5 h-5 text-primary mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <h3 class="font-semibold text-gray-900">Cookie Notice</h3>
        </div>
        <p class="text-sm text-gray-700">
          We use cookies to enhance your browsing experience, provide personalized content, and analyze our traffic. 
          <a href="/cookie-policy" class="text-primary hover:text-secondary underline">Learn more about our cookies</a>.
        </p>
      </div>
      <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
        <button id="cookie-accept-all" class="px-4 py-2 bg-primary text-white font-medium rounded-lg hover:bg-secondary transition-colors text-sm whitespace-nowrap">
          Accept All
        </button>
        <button id="cookie-settings" class="px-4 py-2 bg-neutral-100 text-gray-700 font-medium rounded-lg hover:bg-neutral-200 transition-colors text-sm whitespace-nowrap">
          Cookie Settings
        </button>
        <button id="cookie-reject" class="px-4 py-2 bg-neutral-100 text-gray-700 font-medium rounded-lg hover:bg-neutral-200 transition-colors text-sm whitespace-nowrap">
          Reject Non-Essential
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Cookie Settings Modal -->
<div id="cookie-settings-modal" class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center p-4" style="display: none; z-index: 9999;">
  <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
    <div class="p-6">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-900">Cookie Preferences</h2>
        <button id="cookie-modal-close" class="text-gray-500 hover:text-gray-700">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <p class="text-gray-700 mb-6">
        We use different types of cookies to optimize your experience on our website. 
        You can choose which categories to allow below.
      </p>

      <div class="space-y-4">
        <!-- Essential Cookies -->
        <div class="border border-gray-200 rounded-lg p-4">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center">
              <h3 class="font-semibold text-gray-900">Essential Cookies</h3>
              <span class="ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Required</span>
            </div>
            <input type="checkbox" checked disabled class="rounded border-gray-300">
          </div>
          <p class="text-sm text-gray-600">
            These cookies are necessary for the website to function and cannot be switched off. 
            They enable core functionality such as security, network management, and accessibility.
          </p>
        </div>

        <!-- Functional Cookies -->
        <div class="border border-gray-200 rounded-lg p-4">
          <div class="flex items-center justify-between mb-2">
            <h3 class="font-semibold text-gray-900">Functional Cookies</h3>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="functional-cookies" class="sr-only peer">
              <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
            </label>
          </div>
          <p class="text-sm text-gray-600">
            These cookies allow us to remember choices you make and provide enhanced features. 
            They may be set by us or by third party providers whose services we have added to our pages.
          </p>
        </div>

        <!-- Analytics Cookies -->
        <div class="border border-gray-200 rounded-lg p-4">
          <div class="flex items-center justify-between mb-2">
            <h3 class="font-semibold text-gray-900">Analytics Cookies</h3>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="analytics-cookies" class="sr-only peer">
              <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
            </label>
          </div>
          <p class="text-sm text-gray-600">
            These cookies help us understand how visitors interact with our website by collecting 
            and reporting information anonymously. This helps us improve how our website works.
          </p>
        </div>
      </div>

      <div class="flex flex-col sm:flex-row gap-3 mt-6">
        <button id="cookie-save-settings" class="flex-1 px-4 py-2 bg-primary text-white font-medium rounded-lg hover:bg-secondary transition-colors">
          Save Settings
        </button>
        <button id="cookie-accept-all-modal" class="flex-1 px-4 py-2 bg-neutral-100 text-gray-700 font-medium rounded-lg hover:bg-neutral-200 transition-colors">
          Accept All
        </button>
      </div>

      <div class="mt-4 pt-4 border-t border-gray-200">
        <p class="text-xs text-gray-500">
          For more information about how we use cookies, please see our 
          <a href="/cookie-policy" class="text-primary hover:text-secondary underline">Cookie Policy</a> and 
          <a href="/privacy" class="text-primary hover:text-secondary underline">Privacy Policy</a>.
        </p>
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  'use strict';
  
  // Cookie utility functions
  const CookieConsent = {
    // Cookie names
    CONSENT_COOKIE: 'cookie_consent',
    PREFERENCES_COOKIE: 'cookie_preferences',
    
    // Get cookie value
    getCookie: function(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
      return null;
    },
    
    // Set cookie
    setCookie: function(name, value, days = 365) {
      const expires = new Date();
      expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
      document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/;SameSite=Strict`;
    },
    
    // Check if consent has been given
    hasConsent: function() {
      return this.getCookie(this.CONSENT_COOKIE) !== null;
    },
    
    // Get preferences
    getPreferences: function() {
      const prefs = this.getCookie(this.PREFERENCES_COOKIE);
      if (prefs) {
        try {
          return JSON.parse(prefs);
        } catch (e) {
          return { essential: true, functional: false, analytics: false };
        }
      }
      return { essential: true, functional: false, analytics: false };
    },
    
    // Save preferences
    savePreferences: function(preferences) {
      this.setCookie(this.PREFERENCES_COOKIE, JSON.stringify(preferences));
      this.setCookie(this.CONSENT_COOKIE, 'given');
    },
    
    // Show banner
    showBanner: function() {
      const banner = document.getElementById('cookie-consent');
      if (banner) {
        banner.style.display = 'block';
        setTimeout(() => {
          banner.classList.remove('translate-y-full');
        }, 100);
      }
    },
    
    // Hide banner
    hideBanner: function() {
      const banner = document.getElementById('cookie-consent');
      if (banner) {
        banner.classList.add('translate-y-full');
        setTimeout(() => {
          banner.style.display = 'none';
        }, 300);
      }
    },
    
    // Show modal
    showModal: function() {
      const modal = document.getElementById('cookie-settings-modal');
      if (modal) {
        // Load current preferences
        const prefs = this.getPreferences();
        document.getElementById('functional-cookies').checked = prefs.functional;
        document.getElementById('analytics-cookies').checked = prefs.analytics;
        
        modal.style.display = 'flex';
      }
    },
    
    // Hide modal
    hideModal: function() {
      const modal = document.getElementById('cookie-settings-modal');
      if (modal) {
        modal.style.display = 'none';
      }
    },
    
    // Accept all cookies
    acceptAll: function() {
      this.savePreferences({
        essential: true,
        functional: true,
        analytics: true
      });
      this.hideBanner();
      this.hideModal();
      this.loadOptionalScripts();
    },
    
    // Reject non-essential cookies
    rejectNonEssential: function() {
      this.savePreferences({
        essential: true,
        functional: false,
        analytics: false
      });
      this.hideBanner();
      this.hideModal();
    },
    
    // Save custom settings
    saveSettings: function() {
      const functional = document.getElementById('functional-cookies').checked;
      const analytics = document.getElementById('analytics-cookies').checked;
      
      this.savePreferences({
        essential: true,
        functional: functional,
        analytics: analytics
      });
      
      this.hideBanner();
      this.hideModal();
      
      if (functional || analytics) {
        this.loadOptionalScripts();
      }
    },
    
    // Load optional scripts based on preferences
    loadOptionalScripts: function() {
      const prefs = this.getPreferences();
      
      // Load Google Analytics if analytics cookies are accepted
      if (prefs.analytics && typeof gtag !== 'undefined') {
        gtag('consent', 'update', {
          'analytics_storage': 'granted'
        });
      }
      
      // Add other optional script loading here
    },
    
    // Initialize
    init: function() {
      // Check if consent has been given
      if (!this.hasConsent()) {
        // Wait a bit before showing banner to avoid flash
        setTimeout(() => {
          this.showBanner();
        }, 1000);
      } else {
        // Load scripts based on existing preferences
        this.loadOptionalScripts();
      }
      
      // Event listeners
      const acceptAllBtn = document.getElementById('cookie-accept-all');
      const rejectBtn = document.getElementById('cookie-reject');
      const settingsBtn = document.getElementById('cookie-settings');
      const modalClose = document.getElementById('cookie-modal-close');
      const saveSettingsBtn = document.getElementById('cookie-save-settings');
      const acceptAllModalBtn = document.getElementById('cookie-accept-all-modal');
      
      if (acceptAllBtn) {
        acceptAllBtn.addEventListener('click', () => this.acceptAll());
      }
      
      if (rejectBtn) {
        rejectBtn.addEventListener('click', () => this.rejectNonEssential());
      }
      
      if (settingsBtn) {
        settingsBtn.addEventListener('click', () => this.showModal());
      }
      
      if (modalClose) {
        modalClose.addEventListener('click', () => this.hideModal());
      }
      
      if (saveSettingsBtn) {
        saveSettingsBtn.addEventListener('click', () => this.saveSettings());
      }
      
      if (acceptAllModalBtn) {
        acceptAllModalBtn.addEventListener('click', () => this.acceptAll());
      }
      
      // Close modal when clicking outside
      const modal = document.getElementById('cookie-settings-modal');
      if (modal) {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            this.hideModal();
          }
        });
      }
    }
  };
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => CookieConsent.init());
  } else {
    CookieConsent.init();
  }
  
  // Make CookieConsent available globally for manual control
  window.CookieConsent = CookieConsent;
})();
</script>
<!-- Video Card Component -->
<div class="video-card bg-white bg-opacity-80 rounded-xl border border-gray-200 border-opacity-60 backdrop-blur-sm shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden group" 
     data-language="{{ include.video.language }}" 
     data-category="{{ include.video.category }}">
  
  <!-- YouTube Embed Container -->
  <div class="aspect-video relative bg-gray-100">
    <!-- Thumbnail Image (Shown by default for performance) -->
    <div class="thumbnail-container absolute inset-0 cursor-pointer" onclick="loadVideo(this)">
      <img 
        src="https://img.youtube.com/vi/{{ include.video.youtube_id }}/maxresdefault.jpg" 
        alt="{{ include.video.title }} thumbnail"
        class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
        loading="lazy"
      />
      <!-- Play Button Overlay -->
      <div class="play-button-overlay bg-black bg-opacity-20 group-hover:bg-opacity-30 transition-all duration-300">
        <div class="w-16 h-16 rounded-full flex items-center justify-center shadow-lg transform transition-transform duration-300 group-hover:scale-110" style="background-color: rgba(255, 255, 255, 0.5);" onmouseover="this.style.backgroundColor='rgba(255, 255, 255, 0.9)'" onmouseout="this.style.backgroundColor='rgba(255, 255, 255, 0.5)'">
          <svg class="w-8 h-8 text-gray-800 ml-1" fill="currentColor" viewBox="0 0 24 24">
            <path d="M8 5v14l11-7z"/>
          </svg>
        </div>
      </div>
    </div>
    
    <!-- YouTube iframe (loaded on demand) -->
    <iframe 
      class="youtube-iframe w-full h-full hidden" 
      src="" 
      data-src="https://www.youtube.com/embed/{{ include.video.youtube_id }}?rel=0&modestbranding=1&playsinline=1&enablejsapi=1"
      title="{{ include.video.title }}"
      frameborder="0" 
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
      allowfullscreen>
    </iframe>
  </div>
  
  <!-- Video Metadata -->
  <div class="p-6">
    <!-- Language Badge and Duration -->
    <div class="flex items-center justify-between mb-3">
      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {% if include.video.language == 'en' %}bg-blue-100 text-blue-800{% else %}bg-green-100 text-green-800{% endif %}">
        {% if include.video.language == 'en' %}ðŸ‡ºðŸ‡¸ English{% elsif include.video.language == 'de' %}ðŸ‡©ðŸ‡ª Deutsch{% else %}{{ include.video.language | upcase }}{% endif %}
      </span>
      <span class="text-sm text-gray-500 font-mono">{{ include.video.duration }}</span>
    </div>
    
    <!-- Video Title -->
    <h3 class="text-xl font-bold mb-3 text-gray-900 line-clamp-2 group-hover:text-primary transition-colors duration-300">
      {{ include.video.title }}
    </h3>
    
    <!-- Video Description -->
    <p class="text-gray-600 text-sm leading-relaxed line-clamp-3 mb-4">
      {{ include.video.description }}
    </p>
    
    <!-- Category Tag -->
    <div class="flex items-center justify-between">
      <span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-700 capitalize">
        {{ include.video.category | replace: "-", " " }}
      </span>
      
      <!-- Date -->
      {% if include.video.date %}
      <time class="text-xs text-gray-400" datetime="{{ include.video.date }}">
        {{ include.video.date | date: "%b %d, %Y" }}
      </time>
      {% endif %}
    </div>
  </div>
</div>

<style>
/* Line clamp utility classes for consistent text truncation */
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.line-clamp-3 {
  display: -webkit-box;
  -webkit-line-clamp: 3; 
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Aspect ratio for video containers */
.aspect-video {
  aspect-ratio: 16 / 9;
  position: relative;
}

/* Ensure thumbnail container and play button are properly positioned */
.thumbnail-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.play-button-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .video-card h3 {
    font-size: 1.125rem;
    line-height: 1.4;
  }
  
  .video-card p {
    font-size: 0.875rem;
  }
}
</style>

<script>
function loadVideo(thumbnailContainer) {
  try {
    const card = thumbnailContainer.closest('.video-card');
    const iframe = card.querySelector('.youtube-iframe');
    const thumbnail = thumbnailContainer;
    
    if (!card || !iframe || !thumbnail) {
      console.error('Video loading failed: Missing required elements');
      return;
    }
    
    // Set the iframe src to start loading the video
    iframe.src = iframe.dataset.src;
    
    // Hide thumbnail and show iframe
    thumbnail.style.display = 'none';
    iframe.classList.remove('hidden');
    
    // Focus the iframe for better user experience
    setTimeout(() => {
      iframe.focus();
    }, 100);
    
    // Optional: Track video engagement
    if (typeof gtag !== 'undefined') {
      gtag('event', 'video_play', {
        'video_title': card.querySelector('h3').textContent,
        'video_language': card.dataset.language
      });
    }
  } catch (error) {
    console.error('Error loading video:', error);
    // Fallback: Could show an error message to user
  }
}
</script>
FROM jekyll/jekyll:latest

# Install Node.js and npm for TailwindCSS
RUN apk add --no-cache nodejs npm

# Set working directory
WORKDIR /srv/jekyll

# Copy package files first for better caching
COPY package*.json ./

# Install npm dependencies
RUN npm install

# Install foreman to run multiple processes
RUN gem install foreman

# Copy the rest of the files
COPY . .

# Create a Procfile for foreman
RUN echo "jekyll: jekyll serve --force_polling --livereload --host 0.0.0.0" > Procfile && \
    echo "tailwind: npm run dev" >> Procfile

# Expose ports
EXPOSE 4000 35729

# Run both processes with foreman
CMD ["foreman", "start"]